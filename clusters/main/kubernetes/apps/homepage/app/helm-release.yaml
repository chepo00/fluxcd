apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: homepage
    namespace: homepage
spec:
    interval: 15m
    chart:
        spec:
            chart: homepage
            version: 8.0.9
            sourceRef:
                kind: HelmRepository
                name: truecharts
                namespace: flux-system
    releaseName: homepage
    values:
        credentials:
            minio:
                type: s3
                url: "${S3_URL}"
                bucket: backup
                accessKey: "${S3_ACCESS_KEY}"
                encrKey: "${S3_ENCR_KEY}"
                secretKey: "${S3_SECRET_KEY}"
        ingress:
            main:
                enabled: true
                integrations:
                    traefik:
                        enabled: true
                        entrypoints:
                            - websecure
                    certManager:
                        certificateIssuer: "${DOMAIN_0}-prod"
                        enabled: true
                hosts:
                    - host: homepage.${DOMAIN_0}
                      paths:
                          - path: /
                            pathType: Prefix
        addons:
            codeserver:
                enabled: false
                ingress:
                    enabled: false
                service:
                    ports:
                        codeserver:
                            port: 36001
                    type: LoadBalancer
        persistence:
            config:
                volsync:
                    - name: config
                      type: restic
                      credentials: minio
                      dest:
                          enabled: true
                      src:
                          enabled: true
